# API Migration Guide: Spring HttpExchange → Ktorfit

## Annotation Mapping

| Spring HttpExchange | Ktorfit | Notes |
|---------------------|---------|-------|
| `@HttpExchange("/path")` | Interface without annotation | Base path in each method |
| `@GetExchange` | `@GET("path")` | Full path required |
| `@PostExchange` | `@POST("path")` | Full path required |
| `@PutExchange` | `@PUT("path")` | Full path required |
| `@DeleteExchange` | `@DELETE("path")` | Full path required |
| `@RequestBody` | `@Body` | |
| `@PathVariable("name")` | `@Path("name")` | |
| `@RequestParam("name")` | `@Query("name")` | |
| `@RequestHeader("name")` | `@Header("name")` | |

## Migration Steps for Each Service

1. Copy interface from `jervis/common-api/src/main/kotlin/com/jervis/service/`
2. Change package to `com.jervis.service` (commonMain)
3. Replace annotations:
   - Remove `@HttpExchange` from interface
   - Change `@GetExchange` → `@GET("api/...")`
   - Change `@PostExchange` → `@POST("api/...")`
   - Change `@PutExchange` → `@PUT("api/...")`
   - Change `@DeleteExchange` → `@DELETE("api/...")`
   - Change `@RequestBody` → `@Body`
   - Change `@PathVariable("x")` → `@Path("x")`
   - Change `@RequestParam("x")` → `@Query("x")`
4. Add imports:
   ```kotlin
   import de.jensklingenberg.ktorfit.http.*
   ```

## Services to Migrate

- [ ] IProjectService ✅ (done)
- [ ] IClientService ✅ (done)
- [ ] IClientProjectLinkService ✅ (done)
- [ ] IUserTaskService
- [ ] IIntegrationSettingsService
- [ ] ITaskSchedulingService
- [ ] IGitConfigurationService
- [ ] IPersonaSessionService
- [ ] IRagSearchService
- [ ] IEmailAccountService
- [ ] IConfluenceService
- [ ] IJiraSetupService
- [ ] IAgentOrchestratorService
- [ ] IErrorLogService

## Server Implementation

Server controllers DON'T change! Just implement the interface:

```kotlin
@RestController
@RequestMapping // No path needed, defined in interface
class ProjectController(
    private val projectService: ProjectService
) : IProjectService {

    // Just implement methods from interface
    override suspend fun getAllProjects(): List<ProjectDto> {
        return projectService.getAllProjects()
    }
}
```

## Client Usage (Desktop/Mobile)

```kotlin
// Setup Ktorfit
val ktorfit = Ktorfit.Builder()
    .baseUrl("http://localhost:5500")
    .httpClient(HttpClient {
        install(ContentNegotiation) {
            json(Json {
                ignoreUnknownKeys = true
                isLenient = true
            })
        }
    })
    .build()

// Create service (auto-generated by KSP)
val projectService: IProjectService = ktorfit.create()

// Use it
val projects = projectService.getAllProjects()
```

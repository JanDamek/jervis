---
# ConfigMap pro jervis-server
apiVersion: v1
kind: ConfigMap
metadata:
  name: jervis-server-config
  namespace: jervis
data:
  application.yml: |
    logging:
      level:
        root: INFO
        com.jervis: INFO
        io.ktor: INFO
        org.springframework: INFO
        com.arangodb.internal.serde.SerdeUtils: INFO
        ai.koog: INFO
        com.jervis.koog: INFO
        org.springframework.web: WARN
        org.springframework.web.reactive.socket: WARN
        org.springframework.web.reactive.handler: WARN
        org.springframework.data.mongodb.core.convert.QueryMapper: WARN
      pattern:
        console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
        file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
      file:
        name: /opt/jervis/data/logs/jervis-server.log
      logback:
        rollingpolicy:
          max-history: 7
          max-file-size: 10MB

    spring:
      main:
        web-application-type: none
      mongodb:
        host: 192.168.100.117
        port: 27017
        database: jervis
        username: root
        password: ${MONGODB_PASSWORD}
        authentication-database: admin
      data:
        mongodb:
          auto-index-creation: false

    weaviate:
      host: 192.168.100.117
      port: 8080
      scheme: http
      grpc-port: 50051
      hybrid-search:
        enabled: true
        alpha: 0.85
      auto-migrate:
        countdown-seconds: 10

    ktor:
      connection-pool:
        max-connections: 500
        max-connections-per-route: 100
        keep-alive-time-millis: 300000
      timeouts:
        connect-timeout-millis: 60000
        request-timeout-millis: 1800000
        socket-timeout-millis: 1800000
      api-versions:
        anthropic-version: "2023-06-01"
      logging:
        enabled: false
        level: INFO

    retry:
      ktor:
        max-attempts: 5
        initial-backoff-millis: 1000
        max-backoff-millis: 30000

    data:
      root-dir: /opt/jervis/data

    arango:
      scheme: http
      host: 192.168.100.117
      port: 8529
      database: jervis
      username: root
      password: ${ARANGO_PASSWORD}
      timeout-ms: 5000

    jervis:
      security:
        client-token: a7f3c9e2-4b8d-11ef-9a1c-0242ac120002
      koog:
        max-iterations: 100
        qualifier-max-retries: 5
      background:
        wait-on-startup: 10s
        wait-on-error: 1m
        wait-interval: 30s

    link:
      indexing:
        skip-if-indexed-within: 30d

    preload:
      ollama:
        gpu:
          concurrency: 2
        cpu:
          concurrency: 6
        llm:
          keep-alive: 1h
          refresh-safety-factor: 0.9
        embed:
          concurrency: 6
          keep-alive: 1h
          refresh-safety-factor: 0.9

    coding-tools:
      aider:
        default-provider: ollama
        default-model: "qwen3-coder-tool:30b"
        paid-provider: anthropic
        paid-model: "claude-3-5-sonnet-20241022"
      openhands:
        default-provider: ollama
        default-model: "qwen3-coder-tool:30b"
        paid-provider: anthropic
        paid-model: "claude-3-5-sonnet-20241022"
        ollama-base-url: http://192.168.100.117:11434

    endpoints:
      searxng:
        baseUrl: http://192.168.100.117:30053/
      joern:
        baseUrl: ws://jervis-joern:8082/
      tika:
        baseUrl: ws://jervis-tika:8081/
      whisper:
        baseUrl: ws://jervis-whisper:8083/
      aider:
        baseUrl: ws://jervis-aider:3100/
      coding:
        baseUrl: ws://jervis-coding-engine:3200/
      junie:
        baseUrl: ws://jervis-junie:3300/
      knowledgebase:
        baseUrl: http://jervis-knowledgebase:8080/
      providers:
        github: ws://jervis-github:8085/
        gitlab: ws://jervis-gitlab:8086/
        atlassian: ws://jervis-atlassian:8084/


---
# ConfigMap pro service-knowledgebase
apiVersion: v1
kind: ConfigMap
metadata:
  name: jervis-knowledgebase-config
  namespace: jervis
data:
  OLLAMA_BASE_URL: "http://192.168.100.117:11434"
  OLLAMA_EMBEDDING_BASE_URL: "http://192.168.100.117:11436"
  WEAVIATE_URL: "http://192.168.100.117:8080"
  WEAVIATE_GRPC_URL: "192.168.100.117:50051"
  ARANGO_URL: "http://192.168.100.117:8529"
  ARANGO_DB: "jervis"
  ARANGO_USER: "root"
  TIKA_URL: "http://192.168.100.117:8081"
  JOERN_URL: "http://192.168.100.117:8082"
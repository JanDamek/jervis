# Logging level configuration
logging:
  level:
    root: INFO
    com.arangodb.internal.serde.SerdeUtils: INFO
    com.jervis: INFO
    com.jervis.service: INFO
    ai.koog: INFO
    com.jervis.koog: INFO
    org.springframework.web: WARN
    org.springframework.web.reactive.socket: WARN
    org.springframework.web.reactive.handler: WARN
    org.springframework.data.mongodb.core.convert.QueryMapper: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: ${DATA_ROOT_DIR}/logs/jervis-app.log
  logback:
    rollingpolicy:
      max-history: 7
      max-file-size: 10MB

spring:
  main:
    web-application-type: none
  mongodb:
    host: 192.168.100.117
    port: 27017
    database: jervis
    # Uncomment and set these for production with authentication
    username: root
    password: REDACTED_MONGODB_PASSWORD
    authentication-database: admin
  data:
    mongodb:
      auto-index-creation: false  # Disabled - indexes managed by MongoIndexInitializer

# Vector database configuration
# Weaviate - hybrid search vector DB with BM25 + semantic search
weaviate:
  host: 192.168.100.117  # Change to TrueNAS host after deployment
  port: 8080  # HTTP REST API port
  scheme: http
  grpc-port: 50051  # gRPC port for high-performance operations
  hybrid-search:
    enabled: true
    alpha: 0.85  # 0.85 = 85% semantic + 15% keyword (BM25) - optimized for Czech text with BGE-M3
  auto-migrate:
    countdown-seconds: 10  # Countdown before starting migration (Ctrl+C to abort)

ktor:
  server:
    port: 5500
    max-http-request-header-size: 1GB
  connection-pool:
    max-connections: 500
    max-connections-per-route: 100
    keep-alive-time-millis: 300000  # 5 minutes
  timeouts:
    connect-timeout-millis: 60000
    request-timeout-millis: 1800000  # 30 minutes for reasoning models (Qwen3, DeepSeek, etc.)
    socket-timeout-millis: 1800000   # 30 minutes
  api-versions:
    anthropic-version: "2023-06-01"
  logging:
    enabled: false
    level: "INFO"

# Retry configuration for external HTTP calls
retry:
  ktor:
    max-attempts: 5
    initial-backoff-millis: 1000
    max-backoff-millis: 30000

# Workspace configuration - central root for all server-managed files
data:
  root-dir: ${DATA_ROOT_DIR}

# ArangoDB (Knowledge Graph) configuration
arango:
  scheme: http
  host: 192.168.100.117
  port: 8529
  database: jervis
  username: root
  password: changeit
  timeout-ms: 5000

jervis:
  security:
    client-token: "a7f3c9e2-4b8d-11ef-9a1c-0242ac120002"
    ssl:
      enabled: false  # TODO: Re-enable HTTPS after fixing keystore/Netty SSL configuration issues (2026-01-05)
      key-store: "classpath:keystore.p12"
      key-store-password: "changeit"
      key-alias: "jervis"
      key-password: "changeit"
  koog:
    max-iterations: 50
    qualifier-max-retries: 5
  background:
    wait-on-startup: 10s
    wait-on-error: 1m
    wait-interval: 30s

# Link indexing configuration
link:
  indexing:
    skip-if-indexed-within: 30d

# Ollama preload and keep-alive configuration (fail-fast: all values must be provided)
preload:
  ollama:
    gpu:
      concurrency: 2
    cpu:
      concurrency: 6
    llm:
      keep-alive: 1h
      refresh-safety-factor: 0.9
    embed:
      concurrency: 6
      keep-alive: 1h
      refresh-safety-factor: 0.9

coding-tools:
  aider:
    default-provider: ollama
    default-model: qwen3-coder-tool:30b
    paid-provider: anthropic
    paid-model: claude-3-5-sonnet-20241022
  openhands:
    default-provider: ollama
    default-model: qqwen3-coder-tool:30b
    paid-provider: anthropic
    paid-model: claude-3-5-sonnet-20241022
    ollama-base-url: http://192.168.100.117:11434

endpoints:
  searxng:
    baseUrl: ${SEARXNG_BASE_URL:http://192.168.100.117:30053/}
  openhands:
    baseUrl: ${OPENHANDS_BASE_URL:http://192.168.100.117:3000/}
  joern:
    baseUrl: ${JOERN_BASE_URL:http://192.168.100.117:8082/}
  tika:
    baseUrl: ${TIKA_BASE_URL:http://192.168.100.117:8081/}
  whisper:
    baseUrl: ${WHISPER_BASE_URL:http://192.168.100.117:8083/}
  atlassian:
    baseUrl: ${ATLASSIAN_BASE_URL:http://192.168.100.117:8084/}
  aider:
    baseUrl: ${AIDER_BASE_URL:http://192.168.100.117:3100/}
  coding:
    baseUrl: ${CODING_BASE_URL:http://192.168.100.117:3200/}

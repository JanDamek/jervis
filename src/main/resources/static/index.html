<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Choose Your Role</title>
  <style>
    :root { --bg:#0b1020; --panel:#151c34; --text:#e6e9f2; --muted:#9aa4bf; --accent:#6aa3ff; --accent-2:#9bf0e1; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: radial-gradient(1200px 800px at 70% -10%, rgba(155,240,225,.15), transparent), var(--bg); color: var(--text); display: grid; place-items: center; }
    .card { width: min(880px, 92vw); background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border: 1px solid rgba(255,255,255,.08); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); padding: 28px; }
    h1 { margin: 4px 0 8px; font-size: clamp(20px, 3.2vw, 28px); letter-spacing: .3px; }
    p.lead { margin: 0 0 20px; color: var(--muted); }
    .roles { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 14px; }
    .role { border-radius: 12px; border: 1px solid rgba(255,255,255,.08); background: var(--panel); padding: 18px; cursor: pointer; transition: transform .08s ease, border-color .12s ease, background .12s ease; outline: none; text-align: left; }
    .role:hover, .role:focus-visible { transform: translateY(-2px); border-color: rgba(106,163,255,.6); background: linear-gradient(180deg, rgba(106,163,255,.08), rgba(255,255,255,.02)); }
    .role h2 { margin: 0 0 6px; font-size: 18px; }
    .role p { margin: 0; color: var(--muted); font-size: 14px; }
    .footer { display: flex; justify-content: space-between; align-items: center; margin-top: 18px; color: var(--muted); font-size: 12px; }
    .pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); }
    .current { color: var(--accent-2); font-weight: 600; }
    @media (max-width: 720px) { .roles { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>Pick your persona</h1>
    <p class="lead">Choose what best describes you. We will tailor the experience accordingly. No sign-in required.</p>

    <section class="roles" aria-label="Persona choices">
      <button class="role" data-role="DEVELOPER" aria-label="Developer persona">
        <h2>Developer</h2>
        <p>Code-first, API-centric workflows.</p>
      </button>
      <button class="role" data-role="DESIGNER" aria-label="Designer persona">
        <h2>Designer</h2>
        <p>Visuals, prototypes, and feedback loops.</p>
      </button>
      <button class="role" data-role="MANAGER" aria-label="Manager persona">
        <h2>Manager</h2>
        <p>Planning, tracking, and reporting views.</p>
      </button>
    </section>

    <div class="footer">
      <span id="status" class="pill">Current role: <span class="current" id="currentRole">unknown</span></span>
      <a class="pill" href="https://www.figma.com/file/PLACEHOLDER/Persona-Selection-Mockups" target="_blank" rel="noreferrer noopener">Figma mockups (placeholder)</a>
    </div>
  </main>

  <script>
    async function refresh() {
      try {
        const res = await fetch('/api/session/role', { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error('Failed to read role');
        const json = await res.json();
        document.getElementById('currentRole').textContent = json.role ?? 'unknown';
      } catch (e) {
        document.getElementById('currentRole').textContent = 'unknown';
      }
    }

    async function setRole(role) {
      const res = await fetch('/api/session/role', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({ role })
      });
      if (res.ok) { refresh(); }
    }

    for (const el of document.querySelectorAll('.role')) {
      el.addEventListener('click', () => setRole(el.dataset.role));
    }
    refresh();
  </script>
</body>
</html>
